<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forgot Password — SaaS Starter Kit</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#0a0a0a;color:#e5e5e5;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
.container{max-width:420px;width:100%}
.card{background:#141414;border:1px solid #262626;border-radius:12px;padding:32px}
h1{font-size:28px;font-weight:800;margin-bottom:8px;text-align:center}
.subtitle{text-align:center;color:#a3a3a3;font-size:14px;margin-bottom:24px}
.subtitle a{color:#06b6d4;text-decoration:none}
.subtitle a:hover{text-decoration:underline}
.form-group{margin-bottom:16px}
label{display:block;margin-bottom:6px;font-size:14px;font-weight:600}
input{width:100%;padding:12px;background:#1a1a1a;border:1px solid #262626;border-radius:6px;color:#e5e5e5;font-size:14px}
input:focus{outline:none;border-color:#06b6d4}
.btn{width:100%;padding:14px;background:#06b6d4;color:#0a0a0a;border:none;border-radius:6px;font-weight:700;font-size:14px;cursor:pointer;margin-top:8px}
.btn:hover{background:#0891b2}
.btn:disabled{opacity:0.5;cursor:not-allowed}
.alert{padding:12px;border-radius:6px;margin-bottom:16px;font-size:14px}
.alert-error{background:#7f1d1d;border:1px solid #991b1b;color:#fca5a5}
.alert-success{background:#14532d;border:1px solid #166534;color:#86efac}
.back-link{text-align:center;margin-top:16px;font-size:13px}
.back-link a{color:#06b6d4;text-decoration:none}
.back-link a:hover{text-decoration:underline}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>Reset Password</h1>
    <p class="subtitle">Enter your email to receive a reset link</p>

    <div id="alert" style="display:none"></div>

    <form id="forgotForm">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required placeholder="you@example.com" autofocus>
      </div>

      <button type="submit" class="btn" id="submitBtn">Send Reset Link</button>
    </form>

    <p class="back-link">
      <a href="/login.html">← Back to login</a>
    </p>
  </div>
</div>

<script>
const form = document.getElementById('forgotForm');
const alertBox = document.getElementById('alert');
const submitBtn = document.getElementById('submitBtn');
let csrfToken = null;

// Fetch CSRF token on page load
(async () => {
  try {
    const res = await fetch('/csrf-token');
    const data = await res.json();
    csrfToken = data.csrfToken;
  } catch (err) {
    console.error('Failed to fetch CSRF token:', err);
  }
})();

function showAlert(message, isError = true) {
  alertBox.textContent = message;
  alertBox.className = isError ? 'alert alert-error' : 'alert alert-success';
  alertBox.style.display = 'block';
}

function hideAlert() {
  alertBox.style.display = 'none';
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  hideAlert();

  const email = document.getElementById('email').value.trim();

  if (!email) {
    return showAlert('Email is required');
  }

  submitBtn.disabled = true;
  submitBtn.textContent = 'Sending...';

  try {
    const headers = { 'Content-Type': 'application/json' };
    if (csrfToken) headers['CSRF-Token'] = csrfToken;

    const res = await fetch('/auth/forgot-password', {
      method: 'POST',
      headers,
      body: JSON.stringify({ email })
    });

    const data = await res.json();

    if (!res.ok) {
      throw new Error(data.error || 'Request failed');
    }

    showAlert('If the email exists, a reset link was sent. Check your inbox.', false);
    form.reset();

  } catch (err) {
    showAlert(err.message);
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Send Reset Link';
  }
});
</script>
</body>
</html>
